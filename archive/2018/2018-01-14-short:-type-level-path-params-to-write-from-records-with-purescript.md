<!DOCTYPE html><html xmlns:og="http://ogp.me/ns#"><head><meta charset="UTF-8" /><title>Short: Type-level Path Params to write from Records with PureScript - Qiita</title><meta content="width=device-width,initial-scale=1" name="viewport" /><meta content="Continuing from last time when I wrote about parsing paths from strings using type-level path information to records, I&#39;ll now show how easy it is to write paths from records from the model we had last time.


Review

So the model we had..." name="description" /><meta content="#55c500" name="theme-color" /><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="jusrin00" name="twitter:creator" /><meta content="Short: Type-level Path Params to write from Records with PureScript - Qiita" property="og:title" /><meta content="article" property="og:type" /><meta content="https://qiita.com/kimagure/items/777133d6bbff67e3819d" property="og:url" /><meta content="https://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png" property="og:image" /><meta content="Continuing from [last time](https://qiita.com/kimagure/items/4f5c6054870f631ff768) when I wrote about parsing paths f..." property="og:description" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><link rel="canonical" href="https://qiita.com/kimagure/items/777133d6bbff67e3819d" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public-7b2b83455f893b2e91acb9e4a2cad269.min.css" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="8YdLi30ft/V3nfJZu75LKFtf9FHTOR1/abaZ1/CF/+g/vUmAVwPPH0YNfDwmunTx00z/bwgrPtnSXFwmN5lUOA==" /><script>
  window.gtmDataLayer = [
    {
      'analytics.dimension5': 'false',
      'app.env': 'production',
      'app.layoutVersion': 1,
      'app.userId': null
    },
    { 'gtm.start': new Date().getTime(), event: 'gtm.js' }
  ];
</script>
<script src="https://www.googletagmanager.com/gtm.js?id=GTM-TBQWPN&l=gtmDataLayer" async></script>
</head><body class="without-js" id=""><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';
  window.Qiita = {"asset_host":"cdn.qiita.com","TLD":"com","controller_path":"public/items","controller_action":"public/items#show","controller":"items","action":"show","action_path":"public/items#show","env":"production","flash":{},"is_team_page":false,"request_parameters":{"controller":"public/items","action":"show","user_id":"kimagure","type":"items","id":"777133d6bbff67e3819d"},"root_domain":"qiita.com","variant":null,"config":{"mixpanel":{"per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"17d24b448ca579c365d2d1057f3a1791","team":"b7c0342acba2dbc8742484d98788efb3"},"default_locale":"en","locale":"en"},"team":null,"user":null,"GIT_BRANCH":null,"DEBUG":false};

</script>
<div class="st-HeaderContainer"><script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeaderContainer" data-dom-id="GlobalHeaderContainer-react-component-8b74e207-865b-4352-a3ba-6baf0d06db81">{"user":null,"realms":[{"human_name":"Qiita","is_current_realm":true,"is_qiita":true,"is_qiita_team":false,"logged_in_user":null,"team_id":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","unreadNotificationsCount":null,"locale":"en","is_fluid":false}</script>
    <div id="GlobalHeaderContainer-react-component-8b74e207-865b-4352-a3ba-6baf0d06db81"></div>
    
</div><div id="main"><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', '', 'auto', { name: 'userTracker' });
ga('userTracker.send', 'pageview');</script><script async="" src="https://www.google-analytics.com/analytics.js"></script><script type="application/ld+json">{  "@context": "http://schema.org",  "@type": "BreadcrumbList",  "itemListElement": [    {      "@type": "ListItem",      "position": 1,      "item": {        "@id": "/",        "name": "Qiita"      }    },    {      "@type": "ListItem",      "position": 2,      "item": {        "@id": "/tags/purescript",        "name": "purescript"      }    }  ]}</script><article class="p-items" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="p-items_wrapper"><div class="p-items_container"><div class="p-items_stickyMenu it-Actions" data-mount-target="articleStickyMenu"></div><div class="p-items_main"><div class="p-items_article" data-article-props="{&quot;author&quot;:{&quot;name&quot;:&quot;Justin W&quot;,&quot;urlName&quot;:&quot;kimagure&quot;,&quot;profileImageUrl&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956&quot;,&quot;description&quot;:&quot;Writing about PureScript and Haskell, in English. I can read some Japanese.&quot;,&quot;showUrl&quot;:&quot;https://qiita.com/kimagure&quot;,&quot;followUrl&quot;:&quot;https://qiita.com/kimagure/follow&quot;,&quot;unfollowUrl&quot;:&quot;https://qiita.com/kimagure/unfollow&quot;},&quot;createdAtInUnixtime&quot;:1515939026,&quot;isBanned&quot;:false,&quot;isLiked&quot;:false,&quot;isPublic&quot;:true,&quot;isSecret&quot;:false,&quot;isStocked&quot;:false,&quot;likesCount&quot;:0,&quot;showUrl&quot;:&quot;https://qiita.com/kimagure/items/777133d6bbff67e3819d&quot;,&quot;tags&quot;:[{&quot;isFollowed&quot;:false,&quot;largeIconUrl&quot;:&quot;https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/aba4237de1ecaa284b21c8e42131658769ae1399/large.jpg?1417615690&quot;,&quot;mediumIconUrl&quot;:&quot;https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/336916c820dbea8fa57b306ef0e19e78fb15bf4e/medium.jpg?1417615690&quot;,&quot;name&quot;:&quot;purescript&quot;,&quot;showUrl&quot;:&quot;https://qiita.com/tags/purescript&quot;,&quot;thumbIconUrl&quot;:&quot;https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/57a67566b87fd5d64c996adca3577c52818d156e/thumb.jpg?1417615690&quot;,&quot;urlName&quot;:&quot;purescript&quot;}],&quot;title&quot;:&quot;Short: Type-level Path Params to write from Records with PureScript&quot;,&quot;uuid&quot;:&quot;777133d6bbff67e3819d&quot;,&quot;body&quot;:&quot;\u003cp\u003eContinuing from \u003ca href=\&quot;https://qiita.com/kimagure/items/4f5c6054870f631ff768\&quot; id=\&quot;reference-4b29207decfc22962a32\&quot;\u003elast time\u003c/a\u003e when I wrote about parsing paths from strings using type-level path information to records, I&#39;ll now show how easy it is to write paths from records from the model we had last time.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;review\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#review\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eReview\u003c/h2\u003e\n\n\u003cp\u003eSo the model we had last time looks like this:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003etype\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eMyRoute\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;hello\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;world\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;id\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eInt\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;name\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWhere \u003ccode\u003eS\u003c/code\u003e is an alias for Symbol Proxy, \u003ccode\u003e/\u003c/code\u003e is an operator alias for \u003ccode\u003eTuple\u003c/code\u003e, and \u003ccode\u003eParam\u003c/code\u003e is defined \u003ccode\u003edata Param (label :: Symbol) ty = Param\u003c/code\u003e. We then had typeclass mechanisms to derive a parsing operation for a given string using this information, such that:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eMyRoute\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003etestUrl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003etestUrl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;/hello/world/1/joe\&quot;\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003eparsed\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eEither\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBadTimes\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eid\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eInt\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ename\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eparsed\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparseUrl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etestUrl\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eWhich, in this case, would give us \u003ccode\u003eRight { id: 1, name: \&quot;joe\&quot; }\u003c/code\u003e. Now let&#39;s apply the reverse.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;write-params\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#write-params\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eWrite Params\u003c/h2\u003e\n\n\u003cp\u003eAs the complement of ParseParam we can write WriteParam, but in this case we don&#39;t have to worry about failure operations since you will always be able to write to the path string from a given instance.\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;cd\&quot;\u003e-- | Typeclass for writing URL segments\u003c/span\u003e\n\u003cspan class=\&quot;kr\&quot;\u003eclass\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ea\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003ewriteParam\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ea\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\n\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003estringWriteParam\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteParam\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003ewriteParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e\n\n\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eintWriteParam\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteParam\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eInt\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003ewriteParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etoStringAs\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003edecimal\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;writing-the-url-using-our-type-and-record-of-params\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#writing-the-url-using-our-type-and-record-of-params\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eWriting the URL using our type and Record of params\u003c/h2\u003e\n\n\u003cp\u003eFor writing the URL, we already have the whole row type of the record fields available to us. Like with WriteParam, we will always be able to write out our URL:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003eclass\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e#\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eType\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003ewriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n       \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e\n    \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eRecord\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e\n    \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen our instances end up being not very much work, so for the case of tuples, we will just write the left, the right, and append them together.\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etupleWriteURL\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003ewriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003er\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e\n    \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ewriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003er\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ewriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003er\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen each segment is a matter of reflecting the symbol to a string and formatting it:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegmentWriteURL\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eIsSymbol\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003ewriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\n    \u003cspan class=\&quot;s\&quot;\u003e\&quot;/\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ereflectSymbol\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThe param instance then uses \u003ccode\u003eRowCons\u003c/code\u003e to ensure that the row type we have provided (via our \u003ccode\u003eRecord row\u003c/code\u003e / \u003ccode\u003e{ | row }\u003c/code\u003e) contains the field we need, at the symbol \u003ccode\u003elabel\u003c/code\u003e with the \u003ccode\u003ety\u003c/code\u003e type. As we only care about the existence of the field and not about the sub-row type that is the product of constructing this row type, we can use a throwaway type variable for this.\u003c/p\u003e\n\n\u003cp\u003eAfter applying \u003ccode\u003eRowCons\u003c/code\u003e constraints, we gain access to \u003ccode\u003eRecord.get\u003c/code\u003e to be able to retrieve the field&#39;s value and use it to pass into WriteParam to write our path.\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparamWriteURL\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eIsSymbol\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eRowCons\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ety\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etrash\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ety\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ety\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003ewriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003er\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\n    \u003cspan class=\&quot;s\&quot;\u003e\&quot;/\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparam\u003c/span\u003e\n    \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003ex\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eget\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003er\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003eparam\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ewriteParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ex\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd that&#39;s all! We can just make an alias for this method to expose for usage:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;n\&quot;\u003ewriteUrl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eforall\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e\n   \u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eWriteURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erow\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003ewriteUrl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ewriteURLImpl\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;usage\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#usage\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eUsage\u003c/h2\u003e\n\n\u003cp\u003eWe&#39;ll use the same example type as last time, and then instead of using an output \u003ccode\u003e{ id :: Int, name :: String }\u003c/code\u003e, in this case we&#39;ll be supplying it to output the path:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003etype\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eMyRoute\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;hello\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;world\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;id\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eInt\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;name\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eMyRoute\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e\n\n\u003cspan class=\&quot;c1\&quot;\u003e-- ....\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003etest\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;writeUrl works\&quot;\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003edo\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003eassert\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;writes out /hello/world/1/joe\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e\n        \u003cspan class=\&quot;n\&quot;\u003ewriteUrl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ename\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;joe\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eid\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e==\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;/hello/world/1/joe\&quot;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;conclusion\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#conclusion\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eHopefully this has shown that being able to work with type-level information not only makes it easier to get guarantees about operations in your program, but also can give you flexibility like this, where the same information can be used in multiple contexts. In this case, we&#39;ve used the same information for both a \&quot;server context\&quot; to parse out parameters (which could be used with express or something) and a \&quot;client context\&quot; to prepare parameterized path strings.\u003c/p\u003e\n\n\u003cp\u003eIf our \&quot;client context\&quot; were not in PureScript and did not include such useful features, then code could be generated for it, the same being for the \&quot;server context\&quot;. \u003cem\u003eMaybe if you&#39;re a madman, you will use PureScript solely for domain type modeling and nothing else, who knows.\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;links\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#links\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eLinks\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eThis repo: \u003ca href=\&quot;https://github.com/justinwoo/purescript-la-galbi\&quot; class=\&quot;autolink\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://github.com/justinwoo/purescript-la-galbi\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;isDeprecated&quot;:false,&quot;isDestroyable&quot;:false,&quot;isEditRequestSendable&quot;:false,&quot;isLikable&quot;:true,&quot;isStockable&quot;:true,&quot;isUpdatable&quot;:false,&quot;isUpdated&quot;:true,&quot;likeUrl&quot;:&quot;https://qiita.com/api/internal/items/777133d6bbff67e3819d/likes&quot;,&quot;stockUrl&quot;:&quot;https://qiita.com/kimagure/items/777133d6bbff67e3819d/stock&quot;,&quot;toc&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#review\&quot;\u003eReview\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#write-params\&quot;\u003eWrite Params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#writing-the-url-using-our-type-and-record-of-params\&quot;\u003eWriting the URL using our type and Record of params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#usage\&quot;\u003eUsage\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#conclusion\&quot;\u003eConclusion\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#links\&quot;\u003eLinks\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;totalPv&quot;:235,&quot;unstockUrl&quot;:&quot;https://qiita.com/kimagure/items/777133d6bbff67e3819d/unstock&quot;,&quot;updatedAtInUnixtime&quot;:1515939119}" data-following-likers-props="[]"><div class="it-Header"><div class="u-flex-center-between mb-3"><div class="it-Header_info"><div class="it-Header_author"><a href="/kimagure"><img class="it-Header_authorImage" src="https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956" alt="1512389956" /></a> <a class="it-Header_authorName" href="/kimagure">@kimagure</a> </div><div class="it-Header_time"><meta content="2018-01-14T23:10:26+09:00" itemprop="datePublished" /><span data-toggle="tooltip" title="posted at 2018-01-14">Edited at <time datetime="2018-01-14T23:11:59+09:00" itemprop="dateModified">2018-01-14</time></span></div><div class="it-Header_meta"><div class="it-Header_manipulate"><div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h fa-lg"></span></a><ul class="dropdown-menu dropdown-menu-right"><li class="dropdown__item"><a href="/kimagure/items/777133d6bbff67e3819d/revisions"><span class="fa fa-fw fa-history"></span> Revisions</a></li><li class="dropdown__item"><a href="/kimagure/items/777133d6bbff67e3819d/patches"><span class="fa fa-fw fa-inbox"></span> Edit Requests</a></li><li class="dropdown__item"><a href="/kimagure/items/777133d6bbff67e3819d/likers"><span class="fa fa-fw fa-thumbs-up"></span> Show all likers of this article</a></li><li class="dropdown__item"><a href="/kimagure/items/777133d6bbff67e3819d.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li class="divider" role="separator"></li><li class="dropdown__item"><a data-target=".js-report-form" data-toggle="modal" href="#"><span class="fa fa-fw fa-flag"></span> Report article</a></li></ul></div></div></div></div></div><h1 class="it-Header_title" itemprop="headline">Short: Type-level Path Params to write from Records with PureScript</h1><div class="it-Tags"><a class="it-Tags_item" href="/tags/purescript"><span>purescript</span></a></div></div><div data-mount-target="mobileArticleActions"></div><section class="it-MdContent" itemprop="articleBody"><div id="item-777133d6bbff67e3819d"><p>Continuing from <a href="https://qiita.com/kimagure/items/4f5c6054870f631ff768" id="reference-4b29207decfc22962a32">last time</a> when I wrote about parsing paths from strings using type-level path information to records, I'll now show how easy it is to write paths from records from the model we had last time.</p>

<h2>
<span id="review" class="fragment"></span><a href="#review"><i class="fa fa-link"></i></a>Review</h2>

<p>So the model we had last time looks like this:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">type</span> <span class="kt">MyRoute</span> <span class="o">=</span> <span class="kt">S</span> <span class="s">"hello"</span> <span class="o">/</span> <span class="kt">S</span> <span class="s">"world"</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"id"</span> <span class="kt">Int</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"name"</span> <span class="kt">String</span>
</pre></div></div>

<p>Where <code>S</code> is an alias for Symbol Proxy, <code>/</code> is an operator alias for <code>Tuple</code>, and <code>Param</code> is defined <code>data Param (label :: Symbol) ty = Param</code>. We then had typeclass mechanisms to derive a parsing operation for a given string using this information, such that:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="n">myRouteP</span> <span class="o">::</span> <span class="kt">Proxy</span> <span class="kt">MyRoute</span>
<span class="n">myRouteP</span> <span class="o">=</span> <span class="kt">Proxy</span>

<span class="n">testUrl</span> <span class="o">::</span> <span class="kt">String</span>
<span class="n">testUrl</span> <span class="o">=</span> <span class="s">"/hello/world/1/joe"</span>

<span class="n">parsed</span> <span class="o">::</span> <span class="kt">Either</span> <span class="kt">BadTimes</span> <span class="p">{</span> <span class="n">id</span> <span class="o">::</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">name</span> <span class="o">::</span> <span class="kt">String</span> <span class="p">}</span>
<span class="n">parsed</span> <span class="o">=</span> <span class="n">parseUrl</span> <span class="n">myRouteP</span> <span class="n">testUrl</span>
</pre></div></div>

<p>Which, in this case, would give us <code>Right { id: 1, name: "joe" }</code>. Now let's apply the reverse.</p>

<h2>
<span id="write-params" class="fragment"></span><a href="#write-params"><i class="fa fa-link"></i></a>Write Params</h2>

<p>As the complement of ParseParam we can write WriteParam, but in this case we don't have to worry about failure operations since you will always be able to write to the path string from a given instance.</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="cd">-- | Typeclass for writing URL segments</span>
<span class="kr">class</span> <span class="kt">WriteParam</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="n">writeParam</span> <span class="o">::</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">String</span>

<span class="kr">instance</span> <span class="n">stringWriteParam</span> <span class="o">::</span> <span class="kt">WriteParam</span> <span class="kt">String</span> <span class="kr">where</span>
  <span class="n">writeParam</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span>

<span class="kr">instance</span> <span class="n">intWriteParam</span> <span class="o">::</span> <span class="kt">WriteParam</span> <span class="kt">Int</span> <span class="kr">where</span>
  <span class="n">writeParam</span> <span class="n">i</span> <span class="o">=</span> <span class="n">toStringAs</span> <span class="n">decimal</span> <span class="n">i</span>
</pre></div></div>

<h2>
<span id="writing-the-url-using-our-type-and-record-of-params" class="fragment"></span><a href="#writing-the-url-using-our-type-and-record-of-params"><i class="fa fa-link"></i></a>Writing the URL using our type and Record of params</h2>

<p>For writing the URL, we already have the whole row type of the record fields available to us. Like with WriteParam, we will always be able to write out our URL:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">class</span> <span class="kt">WriteURLImpl</span> <span class="n">xs</span> <span class="p">(</span><span class="n">row</span> <span class="o">::</span> <span class="o">#</span> <span class="kt">Type</span><span class="p">)</span>
  <span class="o">|</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">row</span> <span class="kr">where</span>
  <span class="n">writeURLImpl</span> <span class="o">::</span>
       <span class="kt">Proxy</span> <span class="n">xs</span>
    <span class="o">-&gt;</span> <span class="kt">Record</span> <span class="n">row</span>
    <span class="o">-&gt;</span> <span class="kt">String</span>
</pre></div></div>

<p>Then our instances end up being not very much work, so for the case of tuples, we will just write the left, the right, and append them together.</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">instance</span> <span class="n">tupleWriteURL</span> <span class="o">::</span>
  <span class="p">(</span> <span class="kt">WriteURLImpl</span> <span class="n">left</span> <span class="n">row</span>
  <span class="p">,</span> <span class="kt">WriteURLImpl</span> <span class="n">right</span> <span class="n">row</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">WriteURLImpl</span> <span class="p">(</span><span class="n">left</span> <span class="o">/</span> <span class="n">right</span><span class="p">)</span> <span class="n">row</span> <span class="kr">where</span>
  <span class="n">writeURLImpl</span> <span class="kr">_</span> <span class="n">r</span> <span class="o">=</span>
    <span class="n">left</span> <span class="o">&lt;&gt;</span> <span class="n">right</span>
    <span class="kr">where</span>
      <span class="n">left</span> <span class="o">=</span> <span class="n">writeURLImpl</span> <span class="p">(</span><span class="kt">Proxy</span> <span class="o">::</span> <span class="kt">Proxy</span> <span class="n">left</span><span class="p">)</span> <span class="n">r</span>
      <span class="n">right</span> <span class="o">=</span> <span class="n">writeURLImpl</span> <span class="p">(</span><span class="kt">Proxy</span> <span class="o">::</span> <span class="kt">Proxy</span> <span class="n">right</span><span class="p">)</span> <span class="n">r</span>
</pre></div></div>

<p>Then each segment is a matter of reflecting the symbol to a string and formatting it:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">instance</span> <span class="n">segmentWriteURL</span> <span class="o">::</span>
  <span class="p">(</span> <span class="kt">IsSymbol</span> <span class="n">segment</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">WriteURLImpl</span> <span class="p">(</span><span class="kt">SProxy</span> <span class="n">segment</span><span class="p">)</span> <span class="n">row</span> <span class="kr">where</span>
  <span class="n">writeURLImpl</span> <span class="kr">_</span> <span class="kr">_</span> <span class="o">=</span>
    <span class="s">"/"</span> <span class="o">&lt;&gt;</span> <span class="n">reflectSymbol</span> <span class="p">(</span><span class="kt">SProxy</span> <span class="o">::</span> <span class="kt">SProxy</span> <span class="n">segment</span><span class="p">)</span>
</pre></div></div>

<p>The param instance then uses <code>RowCons</code> to ensure that the row type we have provided (via our <code>Record row</code> / <code>{ | row }</code>) contains the field we need, at the symbol <code>label</code> with the <code>ty</code> type. As we only care about the existence of the field and not about the sub-row type that is the product of constructing this row type, we can use a throwaway type variable for this.</p>

<p>After applying <code>RowCons</code> constraints, we gain access to <code>Record.get</code> to be able to retrieve the field's value and use it to pass into WriteParam to write our path.</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">instance</span> <span class="n">paramWriteURL</span> <span class="o">::</span>
  <span class="p">(</span> <span class="kt">IsSymbol</span> <span class="n">label</span>
  <span class="p">,</span> <span class="kt">RowCons</span> <span class="n">label</span> <span class="n">ty</span> <span class="n">trash</span> <span class="n">row</span>
  <span class="p">,</span> <span class="kt">WriteParam</span> <span class="n">ty</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">WriteURLImpl</span> <span class="p">(</span><span class="kt">Param</span> <span class="n">label</span> <span class="n">ty</span><span class="p">)</span> <span class="n">row</span> <span class="kr">where</span>
  <span class="n">writeURLImpl</span> <span class="kr">_</span> <span class="n">r</span> <span class="o">=</span>
    <span class="s">"/"</span> <span class="o">&lt;&gt;</span> <span class="n">param</span>
    <span class="kr">where</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">get</span> <span class="p">(</span><span class="kt">SProxy</span> <span class="o">::</span> <span class="kt">SProxy</span> <span class="n">label</span><span class="p">)</span> <span class="n">r</span>
      <span class="n">param</span> <span class="o">=</span> <span class="n">writeParam</span> <span class="n">x</span>
</pre></div></div>

<p>And that's all! We can just make an alias for this method to expose for usage:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="n">writeUrl</span> <span class="o">::</span> <span class="n">forall</span> <span class="n">row</span> <span class="n">xs</span>
   <span class="o">.</span> <span class="kt">WriteURLImpl</span> <span class="n">xs</span> <span class="n">row</span>
  <span class="o">=&gt;</span> <span class="kt">Proxy</span> <span class="n">xs</span>
  <span class="o">-&gt;</span> <span class="p">{</span> <span class="o">|</span> <span class="n">row</span> <span class="p">}</span>
  <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">writeUrl</span> <span class="o">=</span> <span class="n">writeURLImpl</span>
</pre></div></div>

<h2>
<span id="usage" class="fragment"></span><a href="#usage"><i class="fa fa-link"></i></a>Usage</h2>

<p>We'll use the same example type as last time, and then instead of using an output <code>{ id :: Int, name :: String }</code>, in this case we'll be supplying it to output the path:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">type</span> <span class="kt">MyRoute</span> <span class="o">=</span> <span class="kt">S</span> <span class="s">"hello"</span> <span class="o">/</span> <span class="kt">S</span> <span class="s">"world"</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"id"</span> <span class="kt">Int</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"name"</span> <span class="kt">String</span>

<span class="n">myRouteP</span> <span class="o">::</span> <span class="kt">Proxy</span> <span class="kt">MyRoute</span>
<span class="n">myRouteP</span> <span class="o">=</span> <span class="kt">Proxy</span>

<span class="c1">-- ....</span>
    <span class="n">test</span> <span class="s">"writeUrl works"</span> <span class="kr">do</span>
      <span class="n">assert</span> <span class="s">"writes out /hello/world/1/joe"</span> <span class="o">$</span>
        <span class="n">writeUrl</span> <span class="n">myRouteP</span> <span class="p">{</span> <span class="n">name</span><span class="o">:</span> <span class="s">"joe"</span><span class="p">,</span> <span class="n">id</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="o">==</span> <span class="s">"/hello/world/1/joe"</span>
</pre></div></div>

<h2>
<span id="conclusion" class="fragment"></span><a href="#conclusion"><i class="fa fa-link"></i></a>Conclusion</h2>

<p>Hopefully this has shown that being able to work with type-level information not only makes it easier to get guarantees about operations in your program, but also can give you flexibility like this, where the same information can be used in multiple contexts. In this case, we've used the same information for both a "server context" to parse out parameters (which could be used with express or something) and a "client context" to prepare parameterized path strings.</p>

<p>If our "client context" were not in PureScript and did not include such useful features, then code could be generated for it, the same being for the "server context". <em>Maybe if you're a madman, you will use PureScript solely for domain type modeling and nothing else, who knows.</em></p>

<h2>
<span id="links" class="fragment"></span><a href="#links"><i class="fa fa-link"></i></a>Links</h2>

<ul>
<li>This repo: <a href="https://github.com/justinwoo/purescript-la-galbi" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/justinwoo/purescript-la-galbi</a>
</li>
</ul>
</div></section><div class="it-Footer"><div data-mount-target="articleFooterMenu"></div><div class="it-Footer_social mt-1of2"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="Short: Type-level Path Params to write from Records with PureScript on @Qiita" data-url="https://qiita.com/kimagure/items/777133d6bbff67e3819d" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="Short: Type-level Path Params to write from Records with PureScript" href="http://b.hatena.ne.jp/entry/https://qiita.com/kimagure/items/777133d6bbff67e3819d" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="https://qiita.com/kimagure/items/777133d6bbff67e3819d" data-size="medium"></div></div><div class="socialButtons_qiitadon"><a class="mastodonShareButton" href="https://qiitadon.com/share?text=Short%3A+Type-level+Path+Params+to+write+from+Records+with+PureScript+by+kimagure+https%3A%2F%2Fqiita.com%2Fkimagure%2Fitems%2F777133d6bbff67e3819d+%23Qiita+%23purescript" target="_blank" title="Toot on Qiitadon">Toot</a></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="https://qiita.com/kimagure/items/777133d6bbff67e3819d" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div></div></div><div class="it-AuthorInfo mt-5" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="/kimagure"><img class="it-AuthorInfo_image" itemprop="image" src="https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956" alt="1512389956" /></a><div class="it-AuthorInfo_body"><div class="it-AuthorInfo_header"><a class="it-AuthorInfo_name" href="/kimagure">Justin W</a><a class="it-AuthorInfo_urlname" itemprop="name" href="/kimagure">@kimagure</a></div><div class="it-AuthorInfo_description">Writing about PureScript and Haskell, in English. I can read some Japanese.</div><div class="it-AuthorInfo_footer"><script type="application/json" id="js-react-on-rails-context">{}</script>
<script type="application/json" class="js-react-on-rails-component" data-component-name="UserFollowButton" data-dom-id="UserFollowButton-react-component-d18ab2ce-c34c-4a4d-b972-4a2550a84e5d">{"initial_followed_by":false,"position":"ArticleAuthorInfo","size":"btn-xs","url_name":"kimagure"}</script>
    <div id="UserFollowButton-react-component-d18ab2ce-c34c-4a4d-b972-4a2550a84e5d"></div>
    
</div></div></div></div></div><div class="p-items_options"></div><div class="p-items_toc"><script type="application/json" class="js-react-on-rails-component" data-component-name="Toc" data-dom-id="Toc-react-component-877d3c63-7a27-439f-a950-a9073b9f73bd">{"body":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#review\"\u003eReview\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#write-params\"\u003eWrite Params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#writing-the-url-using-our-type-and-record-of-params\"\u003eWriting the URL using our type and Record of params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#usage\"\u003eUsage\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#conclusion\"\u003eConclusion\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#links\"\u003eLinks\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n"}</script>
    <div id="Toc-react-component-877d3c63-7a27-439f-a950-a9073b9f73bd"></div>
    
</div></div></div><div class="p-items_container"><div class="p-items_leftDummy"></div><div class="p-items_main"><div class="p-items_aside mt-5"><div id="logly-lift-4279493" /></div><div class="p-items_aside mt-4"><div class="p-items_footnote"><ul class="references js-referencesView mt-5"><li class="references_header"><i class="fa fa-fw fa-link"></i> Linked from these articles</li><li class="references_reference js-reference"><span>Linked from </span><a href="/kimagure/items/4f5c6054870f631ff768#_reference-3ef9c6c950042128f22d"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956" />Type-level Path Params parsed to Records with PureScript</a><time class="references_datetime js-dateTimeView" datetime="2018-01-14T14:11:21+00:00">2 months ago</time></li></ul></div></div><div class="p-items_aside mt-5"><div class="itemsShowComment_wrapper" id="comments"><script type="application/json" class="js-react-on-rails-component" data-component-name="PublicCommentListContainer" data-dom-id="PublicCommentListContainer-react-component-0a83f7c0-f3b4-41f6-ae4d-b4885002c5fe">{"currentUser":null,"initialComments":[],"monthly_public_image_uploadable_size_limit":null,"total_uploaded_public_image_size_in_current_month":null,"item":{"id":599912,"uuid":"777133d6bbff67e3819d","suspended":false,"secret":false},"owner":{"url_name":"kimagure"},"is_team":false,"is_project":false,"logged_in":false,"polling":false,"mention_candidates":[{"id":42481,"url_name":"kimagure","profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956"}]}</script>
    <div id="PublicCommentListContainer-react-component-0a83f7c0-f3b4-41f6-ae4d-b4885002c5fe"></div>
    
<div class="itemsShowCommentSignupOrLogin"><div class="itemsShowCommentSignupOrLogin_title">Sign up for free and join this conversation.</div><a class="btn btn-primary" href="/signup?redirect_to=%2Fkimagure%2Fitems%2F777133d6bbff67e3819d%23comments">Sign Up</a><div class="itemsShowCommentSignupOrLogin_sub">If you already have a Qiita account <a href="/login?redirect_to=%2Fkimagure%2Fitems%2F777133d6bbff67e3819d%23comments">log in.</a></div></div></div></div></div><div class="p-items_rightDummy"></div></div></article><div class="TagList__label" style="display:none"><span></span><span>purescript</span></div><div class="js-report-form modal fade reportForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Report article</h4></div><div class="modal-body"><form class="new_public_issue_report" id="new_public_issue_report" action="/api/internal/issue_reports" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="BWrK0v/NxC+GisOO2EXmsoLrRmvDa3MZy2JfCOfhMo/LUMjZ1dG8xbcaTetFQdlrCvhNVRh5UL9wiJr5IP2ZXw==" /><input type="hidden" value="PublicDomainArticle" name="public_issue_report[target_type]" id="public_issue_report_target_type" /><input type="hidden" value="599912" name="public_issue_report[target_id]" id="public_issue_report_target_id" /><p>Help us understand the problem. What is going on with this item?</p><br /><div class="form-group"><ul class="list-unstyled"><li><label><input required="required" type="radio" value="spam" name="public_issue_report[reason]" id="public_issue_report_reason_spam" /> It&#39;s spam </label></li><li><label><input required="required" type="radio" value="harassment" name="public_issue_report[reason]" id="public_issue_report_reason_harassment" /> It&#39;s abusive or harmful </label></li><li><label><input required="required" type="radio" value="inappropriate_content" name="public_issue_report[reason]" id="public_issue_report_reason_inappropriate_content" /> It contains inappropriate content </label></li></ul></div><div class="reportForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary reportForm_submitButton"><i class="fa fa-send"></i> Submit</button></div></form></div></div></div></div></div><footer class="footer"><div class="footer_inner"><div class="footer_container"><ul class="footer_links-left"><li class="footer_link"><a class="footer_copyright" href="http://increments.co.jp">© 2011-2018 Increments Inc.</a></li><li class="footer_link"><a href="https://qiita.com/terms">Terms</a></li><li class="footer_link"><a href="https://qiita.com/privacy">Privacy</a></li><li class="footer_link"><a href="http://help.qiita.com">Help</a></li><li class="footer_link"><a href="https://increments.zendesk.com/anonymous_requests/new">Contact</a></li></ul><ul class="footer_links-right"><li class="footer_link"><a href="https://qiita.com/about">About</a></li><li class="footer_link"><a href="/users">Users</a></li><li class="footer_link"><a href="/tags">Tags</a></li><li class="footer_link"><a href="/items">Items</a></li><li class="footer_link"><a href="http://blog.qiita.com">Blog</a></li><li class="footer_link"><a href="https://qiita.com/api/v2/docs">API</a></li><li class="footer_link"><a href="https://teams.qiita.com/">Team</a></li><li class="footer_link"><a class="js-public-form-feedback-link" data-target=".js-feedback-form" data-toggle="modal" href=""><i class="fa fa-heart"></i> Feedback <i class="fa fa-caret-down"></i></a></li></ul></div></div></footer><div class="js-feedback-form modal fade feedbackForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Feedback</h4></div><div class="modal-body"><form class="js-feedback-form-form" action="/feedbacks" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="BcgiPzsCEL+W10Rm6tYkVAm0e0UEP++jX9P3n1vEVXXL8iA0ER5oVadHygN30huNgadwe98tzAXkOTJunNj+pQ==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/kimagure/items/777133d6bbff67e3819d" /><div class="form-group"><textarea name="feedback[message]" id="feedback_message" class="form-control js-feedback-form-text-area" placeholder="Please give us any feedback about Qiita." required="required" rows="5">
</textarea></div><div class="feedbackForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary feedbackForm_submitButton"><i class="fa fa-send"></i> Submit</button><p class="feedbackForm_note">We don&#39;t reply to any feedback.<br />If you need help with Qiita, please send a support request from <a href="https://increments.zendesk.com/anonymous_requests/new">here</a>.</p></div><div style="position:fixed;top:-99999px;opacity:0.0001;"><input name="feedback[name]" type="text" /></div></form></div></div></div></div><script>// if (window.mixpanel instanceof Element) {
//   window.mixpanel = [];
// }
// (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
// for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</script><script src="https://cdn.qiita.com/assets/public-0e2574e8ab728cc19b89c3d929c3d35c.min.js"></script></body></html>